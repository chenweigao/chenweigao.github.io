---
layout: article
title: Flask Microframework, Python Web
key: flask
modify_date: 2018-7-25
tags: Python
comment: true
mathjax: true
---

<!--more-->

# Video Streaming with Flask

# Flask Test

The normal test in python includes **unittest, pytest, nose**, we use the nose to make a test.

# Basic Structure

## Context

**application context and request context**：

| variable      | context             | description                                          |
| ------------- | ------------------- | ---------------------------------------------------- |
| `current_app` | application context | The application instance for the active application. |
| `g`           | ac                  |                                                      |
| `request`     | request context     |                                                      |
| `session`     | rc                  |                                                      |

```python
from flask import current_app
```
## Blueprint

We use the `create_app()` so that the application is created at runtime.

> A blueprint is similar to an application in that it can also define routes. The difference is that routes associated with
> a blueprint are in a dormant state until the blueprint is registered with an application, at which point the routes become part of it.

```python
# app/main/__init__.py
from flask import Blueprint
main = Blueprint('main', __name__)
```

The constructor for this class takes two required arguments: **the blueprint name** and **the model or package where the blueprint is located**(always default `__name__`).

## Others

1. `redirect()`: 重定向

2. `url_for()`: 路由地址反向生成

   ```
   url_for('[a function name]')  #输出这个函数对应的URL
   return redirect(url_for('auth.unconfirmed'))
   ```



# Jinja2

## Rendering templates

```python
@app.route('/user/<name>')
def user(name):
    return render_template('user.html', name=name)
```

The function `render_template` takes the filename of the template as its first argument, the additional arguments are `key/value` pairs **that represent actual values for variables referenced in the template**.

`user.html` like this:

```
{% raw-%}
<h1>Hello, {{ name|capitalize }}!</h1>
{% endraw %}
```

In this example, we use the **variable filters**: `safe`, `capitalize`(converts the first character of the value to uppercase), `lower`,`upper`, `title`, `trim`(removes leading and trailing whitespace from the value), `striptags`(removes any HTML tags from the value before rendering).

The default Jinja delimiters are configured as follows:

```
{% raw %}
{% ... %} for statemrnt
	e.g. {% if loop.index is divisibleby 3 %}
{{ ... }} for Expressions to print to the template output
{# ... #} for Comments not included in the template output
#  ... ## for Line Statements
{% endraw %}
```

### Whitespace Control

The official docs about [Whitespace Control](http://jinja.pocoo.org/docs/2.10/templates/#whitespace-control).

`trim_blocks` : remove the first newline after a template tag.

`lstrip_blocks`: strips tabs and spaces from the beginning of a line to the start of a block.

### Line Statements

```
{% raw %}
<ul>
# for item in seq
    <li>{{ item }}</li>
# endfor
</ul>
{% endraw %}
```

equals:

```
{% raw %}
<ul>
{% for item in seq %}
    <li>{{ item }}</li>
{% endfor %}
</ul>
{% endraw %}
```

## Flask_Bootstrap

Install: `pip install flask-bootstrap`

Basic usage:

```python
# app.py
from flask_bootstrap import Bootstrap
app = Flak(__name__)
bootstrap = Bootstrap(app)
```

In the `base.html` file, to import the bootstrap layout:

```
{% raw %}
{% extends "bootstrap/base.html" %}
{% endraw %}
```

If you want run the app:

```python
# app.py
if __name__ == '__main__':
    app.run(port=45467, debug=True)
```

**Flask-moment** is very useful for localization of dates and times, Install `pip install flask-moment`.

```
from flask import import Moment
moment = Moment(app)
```

usage in html file: ‘L’ to ‘LLLL’ for different levels of verbosity.

```
{{ momnet(current_time)}}.format('LLLL') }}
# output: Monday, July 30, 2018 9:31 PM
```



# Web Forms

# Werkzeug

```python
# Werkzeug == 0.14.1
from werkzeug.security import generate_password_hash, check_password_hash

```

[1]: https://www.programiz.com/python-programming/property	"How to understand @property "



# Reference code

```python
# manage.py
import os
from app import create_app, db
from app.models import User, Role
from flask.ext.script import Manager, Shell
from flask.ext.migrate import Migrate, MigrateCommand

app = create_app(os.getenv('FLASK_CONFIG') or 'default')
manager = Manager(app)
migrate = Migrate(app, db)

def make_shell_context():
    return dict(app=app, db=db, User=User, Role=Role)

manager.add_command("shell", Shell(make_context=make_shell_context))
manager.add_command('db', MigrateCommand)

if __name__ == '__main__':
    manager.run()
```

